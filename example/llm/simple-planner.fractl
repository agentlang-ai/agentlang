(component :SimplePlanner)

(dataflow
 :InitWeatherPlannerAgent
 {:Fractl.Inference.Service/Agent
  {:Name "weather-planner-agent"
   :Type "planner"
   :ToolComponents [:q# [:WeatherService]]
   :UserInstruction "You are an agent that figures out which tool to use to answer a user query."}
  :as :Agent}
 {:Fractl.Inference.Service/AgentLLM
  {:Agent :Agent.Name :LLM "llm01"}}
 :Agent)

(inference :InvokePlanner {:agent "weather-planner-agent"})

(dataflow
 :Fractl.Kernel.Lang/AppInit
 {:Fractl.Inference.Provider/LLM
  {:Type "openai"
   :Name "llm01"
   :Config {:ApiKey (fractl.util/getenv "OPENAI_API_KEY")
            :EmbeddingApiEndpoint "https://api.openai.com/v1/embeddings"
            :EmbeddingModel "text-embedding-3-small"
            :CompletionApiEndpoint "https://api.openai.com/v1/chat/completions"
            :CompletionModel "gpt-3.5-turbo"}}}
 [:try {:Fractl.Inference.Service/Agent {:Name? "weather-planner-agent"}}
  :not-found {:InitWeatherPlannerAgent {}}])
